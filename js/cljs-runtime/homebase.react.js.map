{"version":3,"sources":["homebase/react.cljs"],"mappings":";;AAOA,AAAA,AAAMA,AAAUC,AAAUC;AAA1B,AACE,AAAA,AAAK,AAACA,AAAAA,AAAAA;AAAN,AAAA,AAAAC,AACSC;AADT,AAAAD,AACkBE;AADlB,AAEI,AACC,AAACD,AACA,AAAA,AAAK,AAAWC,AACX,AAAAC,AAAS,AAASD;AAAlBC,AAAA,AAAA,AAAAA,AAAA,AAAA,AACS,AAAAA,AAACC,AAAQ,AAACC,AAAW,AAAA,AAAKP;AADnCK,AAAA,AAAA,AAAAA,AAAA,AAAA,AAES,AAAAA,AAACG;AAFV,AAAA,AAAA,AAAAH,AAAA;AAAA;;AAGS,AAAAA,AAACI;;;;AARrB,AAAA,AAAAP;;;;AAUF,AAAA,AAAAQ,AAAAC,AAAAC;AAAA;AAAA,AAAA,AAASC,AAAiB,AAACC;;AAE3B,AAAA,AAAA,AAAA,AAAA,AAAA,AAAKC;AAGL,AAAA,AAAeC,AAAkBC;AAAjC,AACE,AAAMC,AAAO,AAAUD;AACjBE,AAAK,AAACC,AAAc,AAAI,AAAUF,AACZ,AAACG,AAAM,AAACC,AAAgB,AAAUJ,AAASH,AAC3CA;AAH5B,AAIE,AAAM,AAAeG;AAArB,AAA6B,AAACK,AAAeJ,AAAK,AAAeD;;AAAjE;;AACA,AAAA,AAACM,AACA,AAAYX,AAA8BM,AAC1C,AAAYF;;;AAEjB,AAAA,AAAeQ,AAAWC;AAA1B,AACE,AAAMP,AAAK,AAACU,AAAiBhB;AACvBiB,AAAW;AAAA,AAAO,AAAA,AAAA,AAAC/B;AAAD,AAAuB,AAACgC,AAAYZ,AAAKO;;;AADjEC,AAEyB,AAACO,AAAe,AAACJ;AAF1C,AAAAF,AAAAD,AAAA,AAAA,AAEOK;AAFP,AAAAJ,AAAAD,AAAA,AAAA,AAEcM;AAFd,AAGE,AAACE,AACA;AAAA,AACE,AAAMC,AAAI,AAACC;AAAX,AACE,AAAA,AAACC,AAAUnB,AAAKiB;AAAhB,AAAqB,AAAAG,AAAW,AAACT;AAAZ,AAAA,AAAAS,AAAAA,AAACN,AAAAA,AAAAA;;;AACtB;AAAA,AAAiC,AAACO,AAAYrB,AAAKiB;;AAJxD,AAKMV;;AARR,AASGM;;;AAEL,AAAA,AAAA,AAAAS,AAAeM;AAAf,AAAA,AAAAL,AAAA;AAAA,AAAA,AAAAC,AAAA,AAAA;AAAA,AAAA,AAAAC,AAAA;;AAAA,AAAA,AAAA,AAAAA,AAAAD;AAAA,AAAA,AAAAD,AAAA,AAAA,AAAAE;;AAAA,AAAA,AAAAA,AAAA;;;;AAAA;;;;AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAH,AAAA,AAAA,AAAAI,AAAA,AAAAJ,AAAA,AAAA,AAAA,AAAA;AAAA,AAAA,AAAAK,AAAA,AAAA,AAAA,AAAAF;;;;AAAA,AAAA,AAAA,AAAA,AAAeE,AAAUM,AAAQC;AAAjC,AACE,AAAMnC,AAAK,AAACU,AAAiBhB;AACvB2C,AAAU;AAAA,AAAO,AAAA,AAAA,AAACzD;AAAD,AAAsB,AAAC0D,AAAMC,AAAOL,AAAMlC,AAAKmC;;;AADtEC,AAEyB,AAACrB,AAAe,AAACsB;AAF1C,AAAA5B,AAAA2B,AAAA,AAAA,AAEOvB;AAFP,AAAAJ,AAAA2B,AAAA,AAAA,AAEctB;AAFd,AAGE,AAACE,AACA;AAAA,AACE,AAAMC,AAAI,AAACC;AAAX,AACE,AAAA,AAACC,AAAUnB,AAAKiB;AAAhB,AAAqB,AAAAuB,AAAW,AAACH;AAAZ,AAAA,AAAAG,AAAAA,AAAC1B,AAAAA,AAAAA;;;AACtB;AAAA,AAAgC,AAACO,AAAYrB,AAAKiB;;AAJvD,AAKMiB,AAAMC;;AARd,AASGtB;;;AAVL,AAAA,AAAA,AAAee;;AAAf;AAAA,AAAA,AAAA,AAAAC,AAAeD;AAAf,AAAA,AAAAE,AAAA,AAAAC,AAAAF;AAAAA,AAAA,AAAAG,AAAAH;AAAA,AAAA,AAAAI,AAAA;AAAA,AAAA,AAAAA,AAAAH,AAAAD;;;AAAA,AAYA,AAAA,AAAeY;AAAf,AACE,AAAMzC,AAAK,AAACU,AAAiBhB;AACvBgD,AAAS,AAAcC;AAAd,AAAmB,AAAA,AAAA,AAAC/D;AAAD,AAAyB,AAACwB,AAAeJ,AAAK2C;;;AADhF,AAAA,AAEGD","names":["homebase.react/try-hook","hook-name","f","e24076","js/Error","e","G__24078","cljs.core/re-find","cljs.core/re-pattern","cljs.core/second","clojure.string/trim","js/homebase","js/homebase.react","js/homebase.react.homebase-context","homebase.react/homebase-context","js/module$node_modules$react$index.createContext","homebase.react/base-schema","homebase.react/HomebaseProvider","props","config","conn","datascript.core.create_conn","cljs.core.merge","homebase.js/js->schema","homebase.js/transact!","js/module$node_modules$react$index.createElement","homebase.react/useEntity","lookup","vec__24079","cljs.core.nth","js/module$node_modules$react$index.useContext","run-lookup","homebase.js/entity","result","setResult","js/module$node_modules$react$index.useState","js/module$node_modules$react$index.useEffect","key","cljs.core.rand","datascript.core.listen_BANG_","G__24082","datascript.core/unlisten!","var_args","args__4742__auto__","len__4736__auto__","i__4737__auto__","argseq__4743__auto__","cljs.core/IndexedSeq","homebase.react/useQuery","seq24083","G__24084","cljs.core/first","cljs.core/next","self__4723__auto__","query","args","vec__24085","run-query","cljs.core.apply","homebase.js/q","G__24088","homebase.react/useTransact","transact","txs"],"sourcesContent":["(ns homebase.react\n  (:require\n   [\"react\" :as react]\n   [clojure.string]\n   [homebase.js :as hbjs]\n   [datascript.core :as d]))\n\n(defn try-hook [hook-name f]\n  (try (f)\n    (catch js/Error e\n      (throw\n       (js/Error\n        (str (.-message e) \"\\n\"\n             (some->> (.-stack e)\n                      (re-find (re-pattern (str hook-name \".*\\\\n(.*)\\\\n?\")))\n                      (second)\n                      (clojure.string/trim))))))))\n\n(defonce homebase-context (react/createContext))\n\n(def base-schema\n  {:db/ident {:db/unique :db.unique/identity}})\n\n(defn ^:export HomebaseProvider [props]\n  (let [config (.-config props)\n        conn (d/create-conn (if (.-schema config)\n                              (merge (hbjs/js->schema (.-schema config)) base-schema)\n                              base-schema))]\n    (when (.-initialData config) (hbjs/transact! conn (.-initialData config)))\n    (react/createElement\n     (.-Provider homebase-context) #js {:value conn}\n     (.-children props))))\n\n(defn ^:export useEntity [lookup]\n  (let [conn (react/useContext homebase-context)\n        run-lookup (fn [] (try-hook \"useEntity\" #(hbjs/entity conn lookup)))\n        [result setResult] (react/useState (run-lookup))]\n    (react/useEffect\n     (fn use-entity-effect []\n       (let [key (rand)]\n         (d/listen! conn key #(setResult (run-lookup)))\n         (fn unmount-use-entity-effect [] (d/unlisten! conn key))))\n     #js [lookup])\n    [result]))\n\n(defn ^:export useQuery [query & args]\n  (let [conn (react/useContext homebase-context)\n        run-query (fn [] (try-hook \"useQuery\" #(apply hbjs/q query conn args)))\n        [result setResult] (react/useState (run-query))]\n    (react/useEffect\n     (fn use-query-effect []\n       (let [key (rand)]\n         (d/listen! conn key #(setResult (run-query)))\n         (fn unmount-use-query-effect [] (d/unlisten! conn key))))\n     #js [query args])\n    [result]))\n\n(defn ^:export useTransact []\n  (let [conn (react/useContext homebase-context)\n        transact (fn transact [txs] (try-hook \"useTransact\" #(hbjs/transact! conn txs)))]\n    [transact]))\n"]}